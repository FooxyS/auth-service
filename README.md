
# Auth Service

Auth Service — это модульный микросервис аутентификации на Go. Он предоставляет защищённые эндпоинты для регистрации, входа, выхода, обновления токенов и получения информации о пользователе, используя PostgreSQL для хранения данных и JWT для управления токенами. Проект построен по принципам чистой архитектуры, что обеспечивает разделение ответственности и удобство тестирования.

## Возможности
- Регистрация и аутентификация пользователей
- JWT access и refresh токены
- Управление сессиями
- Безопасное хэширование паролей
- Модульная и тестируемая архитектура

## Структура проекта

```
auth-service/
├── cmd/                  # Точка входа приложения
├── internal/
│   ├── adapters/         # HTTP-обработчики и роутинг (транспортный слой)
│   ├── domain/           # Основные бизнес-сущности и интерфейсы
│   ├── infrastructure/   # Реализации БД, хэширования, токенов
│   └── usecase/          # Бизнес-логика (use cases)
├── pkg/                  # Общие утилиты и константы
├── Dockerfile
├── docker-compose.yml
├── go.mod, go.sum
└── ...
```

## Описание пакетов

### internal/adapters
Реализует транспортный слой (delivery) сервиса аутентификации. Связывает внешние интерфейсы (например, HTTP) с бизнес-логикой приложения, обрабатывает запросы, ответы и маршрутизацию.

- Экспортирует функциональность сервиса через HTTP-эндпоинты.
- Маппит входящие запросы на вызовы use case и формирует ответы.
- Обрабатывает валидацию, ошибки и сериализацию ответов.

Ключевые компоненты:
- `http/handler/` — HTTP-обработчики для login, register, logout, refresh, me.
- `http/router/` — Настройка роутера и маршрутов.

### internal/domain
Определяет основные бизнес-сущности и интерфейсы сервиса аутентификации. Описывает доменную модель, контракты и абстракции, используемые во всём приложении, независимо от инфраструктуры.

- Описывает сущности (User, Session, Token и др.).
- Определяет интерфейсы репозиториев и сервисов (UserRepository, SessionRepository, PasswordHasher, TokenService).
- Является фундаментом бизнес-логики и разграничивает слои приложения.

### internal/infrastructure
Содержит конкретные реализации инфраструктурных сервисов и адаптеров. Инкапсулирует детали работы с БД, хэшированием паролей и токенами, отделяя их от бизнес-логики и HTTP-слоя.

- Реализует доменные интерфейсы репозиториев и сервисов.
- Работает с внешними зависимостями: PostgreSQL, хэширование, JWT.
- Упрощает мокирование и тестирование за счёт абстракции инфраструктуры.

Ключевые компоненты:
- `hasher/password_hasher.go` — Хэширование и сравнение паролей (например, bcrypt).
- `postgres/user_repo.go` — Репозиторий пользователей (CRUD в PostgreSQL).
- `postgres/session_repo.go` — Репозиторий сессий пользователей.
- `tokens/token_service.go` — Генерация и валидация JWT-токенов.

### internal/usecase
Содержит основную бизнес-логику (use cases) сервиса аутентификации. Оркестрирует взаимодействие между доменными сущностями, репозиториями и инфраструктурными сервисами для реализации сценариев приложения.

- Реализует бизнес-правила (логин, регистрация, логаут, обновление токенов, информация о пользователе).
- Координирует работу доменных моделей и инфраструктуры.
- Является основной точкой входа для бизнес-логики, не зависит от транспорта и инфраструктуры.

Ключевые use case:
- `LoginUseCase` — Аутентификация пользователя и выдача токенов.
- `RegisterUseCase` — Регистрация нового пользователя.
- `LogoutUseCase` — Выход пользователя и удаление сессии.
- `RefreshUseCase` — Обновление токенов и сессии.
- `MeUseCase` — Получение информации о текущем пользователе.

### pkg
Содержит общие утилиты и константы, используемые во всём сервисе. Предоставляет переиспользуемые хелперы, определения ошибок и ключи конфигурации, не относящиеся к конкретному слою.

- Централизует общий код, ошибки и константы для всего проекта.
- Снижает дублирование и упрощает поддержку.
- Держит вспомогательные функции вне бизнес-логики и инфраструктуры.

Ключевые компоненты:
- `apperrors/errors.go` — Общие определения ошибок.
- `consts/ctx_keys.go` — Ключи для хранения/получения значений в context.
- `consts/env_keys.go` — Ключи переменных окружения.
- `consts/names.go` — Прочие строковые константы.

## Быстрый старт

### Требования
- Go 1.20+
- Docker и Docker Compose

### Запуск сервиса
1. Клонируйте репозиторий:
	```sh
	git clone https://github.com/FooxyS/auth-service.git
	cd auth-service
	```
2. Создайте файл `.env` на основе `.env.example` и задайте переменные окружения.
3. Соберите и запустите сервис через Docker Compose:
	```sh
	docker-compose up --build
	```
4. Сервис будет доступен на `http://localhost:8088`.

### Запуск тестов
```sh
go test ./internal/usecase/...
```

## API эндпоинты
- `POST /register` — регистрация пользователя
- `POST /login` — вход пользователя
- `POST /logout` — выход пользователя
- `POST /refresh` — обновление токенов
- `GET /me` — информация о текущем пользователе

